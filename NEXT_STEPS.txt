# GameCoach.AI 프로젝트 - 다음 단계 가이드
생성일: 2025-01-XX

## ✅ 완료된 작업 요약

### 인프라 및 데이터베이스
- PostgreSQL 데이터베이스 스키마 구축
- Drizzle ORM 설정 및 연결
- 자동 마이그레이션 시스템

### 인증 시스템
- JWT 기반 인증 완료
- 회원가입/로그인/로그아웃 API
- Rate limiting (IP당 5회/분)
- 역할 기반 접근 제어 (user, admin, coach)

### 프론트엔드 페이지
- 홈페이지 (랜딩 페이지)
- 코치 목록/상세 페이지
- 강의 구매 페이지
- 리뷰 페이지
- 로그인/회원가입 페이지
- 관리자 대시보드
- 코치 대시보드 (프로필 설정, 강의 관리, 수강생 관리, 일정 관리)
- 사용자 마이페이지 (수강 신청 내역)

### API 엔드포인트
- 인증: /api/auth/* (login, signup, logout, verify)
- 코치: /api/coaches/* (목록, 상세, 내 코치, 일정 관리, 예약 가능 시간)
- 리뷰: /api/reviews/* (목록, 상세)
- 웨이팅리스트: /api/waitlist/*
- 사용자: /api/users/*
- 수강 신청: /api/enrollments/* (목록, 상세, 상태 변경)
- 업로드: /api/upload
- 관리자: /api/admin/stats

## ⚠️ 현재 남아있는 하드코딩

~~1. app/coaches/page.tsx - Jomanjal 코치 (ID: 0) 하드코딩~~ ✅ 완료
~~2. app/coaches/[id]/page.tsx - Jomanjal 상세 정보 하드코딩~~ ✅ 완료
~~3. lib/instructors.ts - 강사 데이터 하드코딩~~ ✅ 완료 (파일 삭제됨)

## 📋 다음 단계 우선순위

### 1단계: 하드코딩 제거 및 데이터 정리 (즉시) ✅ 완료
우선순위: 높음 | 예상 시간: 1-2시간

- [x] Jomanjal 코치를 DB에 등록하거나 하드코딩 제거 ✅ 완료 (2025-01-XX)
- [x] lib/instructors.ts 정리 (사용 여부 확인) ✅ 완료 (파일 삭제됨)
- [x] 하드코딩 데이터를 DB로 마이그레이션 ✅ 완료
- [x] 참고용 주석 제거 ✅ 완료

---

### 2단계: 핵심 기능 완성도 향상
우선순위: 높음 | 예상 시간: 2-3일

#### 2-1. 코치 프로필 이미지 업로드 ✅ 완료
- [x] /api/upload 엔드포인트 검증 ✅ 완료
- [ ] 이미지 업로드 UI/UX 개선 (선택사항)
- [ ] 프로필 이미지 표시 개선 (선택사항)
- [x] 이미지 최적화 및 리사이징 로직 추가 ✅ 완료 (Sharp 사용, WebP 변환)
- [x] 파일 형식 검증 (jpg, png, webp) ✅ 완료 (MIME 타입 + 매직 넘버 검증)

#### 2-2. 리뷰 시스템 개선 ✅ 완료
- [ ] 리뷰 작성 UI/UX 개선 (선택사항)
- [x] 리뷰 평점 계산 로직 검증 ✅ 완료 (소수점 1자리 반올림, 자동 업데이트)
- [x] 리뷰 정렬 기능 (최신순, 평점순) ✅ 완료 (최신순, 평점 높은순, 평점 낮은순)
- [ ] 리뷰 필터링 (별점별) (선택사항)
- [x] 리뷰 작성 후 즉시 반영 확인 ✅ 완료 (리뷰 작성/승인/삭제 시 자동 새로고침 및 알림)
- [x] 중복 리뷰 방지 로직 추가 ✅ 완료 (같은 사용자가 같은 코치에게 중복 리뷰 작성 방지)

#### 2-3. 코치 상세 페이지 (부분 완료)
- [x] 소개 이미지 표시 개선 ✅ 완료
- [x] introductionContent JSON 파싱 검증 ✅ 완료 (에러 처리 포함)
- [x] 커리큘럼 항목 표시 개선 ✅ 완료
- [x] 강의 시간(totalCourseTime) 표시 ✅ 완료 (자동 계산 포함)
- [x] 할인 가격 표시 로직 검증 ✅ 완료

---

### 3단계: 사용자 경험 개선
우선순위: 중간 | 예상 시간: 3-5일

#### 3-1. 검색 및 필터링 ✅ 완료
- [x] 코치 검색 성능 개선 ✅ 완료 (데이터베이스 인덱스 추가, COUNT 쿼리 최적화, 가격 필터 DB 레벨 처리, ILIKE 검색)
- [x] 필터링 옵션 확장 (티어, 가격대, 평점) ✅ 완료 (게임별, 가격대 필터링 구현됨)
- [x] 정렬 옵션 추가 (평점순, 가격순, 최신순) ✅ 완료 (6가지 정렬 옵션 구현됨)
- [ ] 검색 결과 개수 표시 (취소 - 불필요)

#### 3-2. 알림 시스템 ✅ 완료
- [x] 토스트 알림 개선 (Sonner 활용) ✅ 완료
- [x] 에러 메시지 구체화 ✅ 완료
- [x] 성공 메시지 일관성 확보 ✅ 완료
- [x] 로딩 상태 표시 개선 ✅ 완료

#### 3-3. 페이지네이션 ✅ 완료
- [x] 코치 목록 페이지네이션 구현 ✅ 완료
- [x] 리뷰 목록 페이지네이션 구현 ✅ 완료
- [ ] 무한 스크롤 옵션 추가 (선택사항)
- [ ] 페이지당 항목 수 조정 가능 (선택사항)

---

### 4단계: 추가 기능 구현
우선순위: 낮음-중간 | 예상 시간: 1-2주

#### 4-1. 코치-사용자 연결 ✅ 완료
- [x] 수강 신청 기능 ✅ 완료
- [x] 코칭 세션 예약 시스템 ✅ 완료 (세션 테이블 제거됨 - enrollments로 통합)
- [x] 수강생 관리 기능 ✅ 완료
- [x] 일정 관리 기능 ✅ 완료
  - [x] 코치 주간 일정 설정 UI (요일별 토글, 시간 범위 설정) ✅ 완료
  - [x] 일정 관리 API 엔드포인트 (/api/coaches/my/schedule) ✅ 완료
  - [x] 데이터베이스 스키마 (coach_schedules 테이블) ✅ 완료
  - [x] 강의 구매 페이지와 일정 동기화 ✅ 완료
- [x] 강의 구매 페이지 개선 ✅ 완료
  - [x] 희망 일정 필수 선택으로 변경 ✅ 완료
  - [x] 가장 빠른 일정 자동 선택 기능 ✅ 완료
  - [x] 게임 정보 입력 기능 (랭크, 포지션, 요원) ✅ 완료
  - [x] 일정 미선택 시 구매 버튼 비활성화 ✅ 완료
- [x] 수강 신청 플로우 개선 ✅ 완료
  - [x] 코치 취소 메시지가 사용자에게 표시되도록 수정 ✅ 완료
  - [x] 결제하기 버튼을 대기 중 상태에서 표시하도록 수정 ✅ 완료

#### 4-2. 결제 시스템 (장기)
- [ ] 결제 API 연동 (포트원, 토스페이먼츠 등)
- [ ] 결제 내역 관리
- [ ] 환불 처리 시스템
- [ ] 정기 결제 옵션

#### 4-3. 실시간 통신 (장기)
- [ ] 채팅 기능 (WebSocket 또는 서드파티)
- [ ] 알림 시스템
- [ ] 라이브 코칭 세션
- [ ] 화상 통화 연동

---

### 5단계: 성능 및 보안 강화
우선순위: 중간 | 예상 시간: 지속적

#### 5-1. 성능 최적화
- [ ] 이미지 최적화 (Next.js Image 컴포넌트)
- [ ] 코드 스플리팅
- [ ] API 응답 캐싱
- [ ] 데이터베이스 쿼리 최적화
- [ ] 인덱싱 확인

#### 5-2. 보안 강화 ✅ 완료
- [x] 프로덕션 환경 디버깅 정보 제거 ✅ 완료 (login, signup, upload API)
- [x] 입력 검증 강화 ✅ 완료 (Zod 스키마를 모든 주요 API에 적용)
- [x] SQL Injection 방지 검증 ✅ 완료 (입력 sanitization, 위험 패턴 검증 추가)
- [x] XSS 방지 강화 ✅ 완료 (DOMPurify를 모든 사용자 입력 렌더링 위치에 적용)
- [x] CSRF 보호 구현 ✅ 완료 (CSRF 토큰 생성/검증 및 모든 POST/PATCH API에 적용)
- [ ] 환경 변수 암호화 (Vercel에서 자동 처리됨)

#### 5-3. 모니터링 및 로깅
- [ ] 에러 로깅 시스템 (Sentry 등)
- [ ] 성능 모니터링
- [ ] 사용자 행동 분석
- [ ] API 사용량 추적

---

### 6단계: 문서화 및 배포
우선순위: 낮음 | 예상 시간: 지속적

#### 6-1. 문서화
- [ ] API 문서화
- [ ] 배포 가이드 업데이트
- [ ] 개발 환경 설정 가이드
- [ ] 사용자 가이드 작성

#### 6-2. 테스트
- [ ] 단위 테스트 작성
- [ ] 통합 테스트 작성
- [ ] E2E 테스트 작성
- [ ] 성능 테스트

---

## 🎯 권장 다음 작업 (바로 시작 가능)

### 즉시 작업 (오늘/내일) ✅ 대부분 완료
~~1. 하드코딩 데이터 정리~~ ✅ 완료
   ~~- Jomanjal 코치를 DB에 등록 또는 코드 제거~~ ✅ 완료
   ~~- 불필요한 하드코딩 제거~~ ✅ 완료
   ~~- 파일: app/coaches/page.tsx, app/coaches/[id]/page.tsx, lib/instructors.ts~~ ✅ 완료

~~2. 이미지 업로드 검증~~ ✅ 완료
   ~~- /api/upload 엔드포인트 동작 확인~~ ✅ 완료 (구현 완료)
   ~~- 코치 프로필 이미지 업로드 테스트~~ (실제 테스트 필요)
   ~~- 파일: app/api/upload/route.ts~~ ✅ 완료

~~3. 리뷰 시스템 점검~~ ✅ 완료
   ~~- 리뷰 작성 플로우 검증~~ ✅ 완료 (중복 리뷰 방지 추가)
   ~~- 평점 계산 로직 확인~~ ✅ 완료 (소수점 1자리 반올림, 자동 업데이트)
   ~~- 파일: app/api/reviews/*, app/reviews/page.tsx~~ ✅ 완료

### 단기 작업 (이번 주) ✅ 대부분 완료
~~4. 코치 상세 페이지 완성~~ ✅ 완료
   ~~- 소개 이미지/컨텐츠 표시 개선~~ ✅ 완료
   ~~- 커리큘럼 표시 개선~~ ✅ 완료
   ~~- 파일: app/coaches/[id]/page.tsx~~ ✅ 완료

5. 검색 기능 개선 (부분 완료)
   - 검색 성능 최적화 (추가 최적화 가능)
   ~~- 필터링 옵션 추가~~ ✅ 완료 (게임별, 가격대 필터링 구현됨)
   - 파일: app/coaches/page.tsx, app/api/coaches/route.ts

6. 사용자 피드백 수집
   - 실제 사용자 테스트
   - UI/UX 개선점 파악

---

## 📝 체크리스트 사용법

1. 각 작업을 완료할 때마다 [ ] → [x]로 변경
2. 완료 날짜를 옆에 기록 (예: [x] 2025-01-XX)
3. 새로운 발견사항이나 이슈는 별도 섹션에 기록
4. 우선순위 변경 시 이 문서 업데이트

---

## 💡 참고사항

- 이 문서는 프로젝트 상태에 따라 업데이트 필요
- 각 단계는 독립적으로 진행 가능하지만, 1단계는 먼저 완료 권장
- 기능 추가 시 이 문서도 함께 업데이트
- 완료된 작업은 체크박스로 표시하여 진행 상황 추적

---

## 🔄 업데이트 이력

- 2025-01-XX: 초기 버전 작성
- 2025-01-XX: 진행 상황 업데이트 - 하드코딩 제거, 이미지 업로드, 페이지네이션, 리뷰 정렬, 검색/필터링 등 완료 표시
- 2025-01-XX: 리뷰 시스템 검증 완료 - 평점 계산 로직 개선 (소수점 1자리 반올림), 중복 리뷰 방지 추가, 리뷰 작성/승인/삭제 후 즉시 반영 및 알림 개선
- 2025-01-XX: 알림 시스템 완료 표시 - Sonner 토스트 알림이 이미 전역적으로 구현되어 있음 확인
- 2025-01-XX: 코치 검색 성능 개선 완료 - 데이터베이스 인덱스 추가 (name, specialty, tier, verified, active, price, rating, createdAt), COUNT 쿼리 최적화, 가격 필터 DB 레벨 처리, ILIKE 검색으로 대소문자 구분 없음
- 2025-01-XX: 코치-사용자 연결 기능 완료 - 수강 신청, 코칭 세션 예약, 수강생 관리, 일정 관리 기능 구현 완료, API 일관성 수정 (user.id → user.userId)
- 2025-01-XX: 강의 구매 페이지 개선 완료 - 게임 정보 저장 기능 추가, 사용하지 않는 코드 제거, 에러 처리 강화, API 호출 디바운싱 적용, 프로덕션 환경 디버깅 정보 제거
- 2025-01-XX: 일정 관리 기능 완성 - 코치 주간 일정 관리 UI 구현 (요일별 토글, 시간 범위 설정), 데이터베이스 스키마 추가 (coach_schedules 테이블), API 엔드포인트 구현, 강의 구매 페이지와 일정 동기화 완료
- 2025-01-XX: 강의 구매 페이지 개선 - 희망 일정 필수 선택으로 변경, 가장 빠른 일정 자동 선택 기능 추가, 일정 미선택 시 구매 버튼 비활성화
- 2025-01-XX: 수강 신청 플로우 개선 - 코치 취소 메시지가 사용자에게 표시되도록 수정, 결제하기 버튼을 대기 중 상태에서 표시하도록 수정
- 2025-01-XX: 보안 강화 - 프로덕션 환경 디버깅 정보 제거 (login, signup, upload API에서 스택 트레이스 및 상세 에러 정보 제한)
- 2025-01-XX: 세션 테이블 제거 - sessions 테이블 및 관련 코드 완전 삭제, enrollments로 통합

